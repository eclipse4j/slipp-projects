<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>레이스!</title>
    <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mustache.js/2.3.0/mustache.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.0.11/handlebars.min.js"></script>

    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet"
          href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"
          integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u"
          crossorigin="anonymous">

    <!-- Optional theme -->
    <link rel="stylesheet"
          href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css"
          integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp"
          crossorigin="anonymous">

    <!-- Latest compiled and minified JavaScript -->
    <script
            src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"
            integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"
            crossorigin="anonymous"></script>

    <style>
        body {
            padding-top: 40px;
            padding-bottom: 40px;
            background-color: #eee;
        }

        .form-lotto {
            max-width: 1000px;
            padding: 15px;
            margin: 0 auto;
        }

        .form-lotto .form-control {
            position: relative;
            height: auto;
            -webkit-box-sizing: border-box;
            -moz-box-sizing: border-box;
            box-sizing: border-box;
            padding: 10px;
            font-size: 16px;
        }

        .submit-button {
            margin-top: 10px;
        }
    </style>

</head>
<body>

<div class="container">
    <div class="row">

        <div class="col-md-12">
            <form class="form-lotto" name="racingForm" id="racingForm" method="post" action="/reactive/play">
                <h2 class="text-center">박진감 넘치는 자동차 레이싱 게임 유저</h2>
                <div class="form-show-div form-group">
                    <h2>이름을 입력하시오.</h2>
                    (이름마다 띄어쓰기로 구분해 주세요.)
                    <textarea class="form-control playersName" rows="3" name="playersName"
                              placeholder="에이군, 비군, 씨군, 디군"></textarea>
                </div>
                <div class="submit-button">
                    <button id="submitBtn" class="btn btn-lg btn-primary btn-block" type="button">게임 시작</button>
                </div>
            </form>
        </div>

    </div>
    <div class="row">
        <div id="racingResult">

        </div>
    </div>
</div>

<template id="template" type="x-tmpl-mustache">
    <h1>My Favorite European Cities</h1>
    <ul>
        {{#cities}}
        <li>{{name}}</li>
        {{/cities}}
    </ul>
</template>


<script type="application/javascript">
    var templateHtmlPrefix = '<table class="table"><thead><tr><th style="width: 20%">Name</th><th>Move</th></tr></thead><tbody>';
    var templateHtmlSuffix = '</tbody></table>';

    $(document).ready(function(){
        $("#submitBtn").on('click', function(e){
            e.preventDefault();
            var playersName = $(".playersName").val();
            var formJson = {"playersName":playersName};
            $.ajax({
                url: '/reactive/play',
                type : "POST",
                contentType: "application/json;charset=utf-8",
                dataType : 'json',
                data : JSON.stringify(formJson),
                success : function(result) {

                    var templateHtmlCore = "";
                    $.each(result.players, function(k, v){
                        templateHtmlCore += "<tr><td>"+v.playerName+"</td><td><div style='background: aquamarine; width: "+(v.pos * 10)+"px'>"+v.pos+"</div></td>"
                    });
                    templateHtmlCore = templateHtmlPrefix + templateHtmlCore + templateHtmlSuffix;

                    //var template = $("#template").html();
                    //Mustache.parse(template);
                    //var gameResultHtml = Mustache.render(template, data);

                    $("#racingResult").html(templateHtmlCore);
                },
                error: function(xhr, resp, text) {
                    console.log(xhr, resp, text);
                }
            });
        });
    });
</script>
</body>
</html>